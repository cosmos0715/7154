<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三酒豌豆</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .nav {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }

        .clips-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
            padding: 0 10px;
        }
        .clip-card {
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s ease;
        }
        .clip-card:hover {
            transform: translateY(-5px);
        }
        .clip-cover img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 8px 8px 0 0;
        }
        .clip-info {
            padding: 12px;
        }
        .clip-title {
            font-size: 16px;
            margin: 0 0 8px;
            line-height: 1.4;
        }
        .clip-title a {
            text-decoration: none;
        }
        .clip-title a:hover {
            text-decoration: underline;
        }
        .clip-date {
            font-size: 14px;
            margin: 0;
            opacity: 0.8;
        }
        .empty-tip {
            text-align: center;
            padding: 40px 0;
            font-size: 16px;
        }

        #videoPlayerContainer {
            margin: 20px auto;
            padding: 15px;
            border-radius: 8px;
            max-width: 800px;
            width: 90%;
            display: none;
        }
        #bilibiliPlayer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        .player-ratio-box {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav">
            <a class="active" data-target="home">首页</a>
            <a data-target="live" data-file="live.html">直播录像</a>
            <a data-target="playlist" data-file="playlist.html">歌单</a>
            <a data-target="fanwork" data-file="fanwork.html">切片</a>
            <a data-target="message" data-file="message.html">水友留言板</a>
        </div>

        <div class="profile-section">
            <h1>三酒豌豆</h1>
            <div class="intro">
                风吹哪页读哪页，读到繁星落眉时。
            </div>
        </div>
        
        <div id="home" class="content-section active">
            <h2>首页</h2>
            <p>三酒直播间：<a href="https://www.douyu.com/2421040?dyshid=5429a3-5d35afbce431b49c172e5c6500081701" target="_blank" rel="noopener noreferrer" class="live-link">斗鱼2421040</a></p>
            <p>豌豆直播间：<a href="https://www.douyu.com/12282113?dyshid=5429a3-5d35afbce431b49c172e5c6500081701" target="_blank" rel="noopener noreferrer" class="live-link">斗鱼12282113</a></p>
        </div>
        
        <div id="live" class="content-section"></div>
        <div id="playlist" class="content-section"></div>
        <div id="clips" class="content-section"></div>
        <div id="fanwork" class="content-section"></div>
        <div id="message" class="content-section"></div>
    </div>

    <script>
        // 文本颜色适配
        function setTextColorByBackground() {
            const bodyStyle = getComputedStyle(document.body);
            const bgGradient = bodyStyle.backgroundImage;
            const firstColorMatch = bgGradient.match(/#[0-9a-fA-F]{6}/);
            const bgColor = firstColorMatch ? firstColorMatch[0] : '#ffffff';

            const hexToRgb = (hex) => {
                const r = parseInt(hex.slice(1, 3), 16);
                const g = parseInt(hex.slice(3, 5), 16);
                const b = parseInt(hex.slice(5, 7), 16);
                return { r, g, b };
            };

            const { r, g, b } = hexToRgb(bgColor);
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;
            const isLightBg = brightness > 128;
            const textColor = isLightBg ? '#333333' : '#f5f5f5';
            const linkColor = isLightBg ? '#0078ff' : '#4db8ff';
            const activeLinkColor = isLightBg ? '#0056b3' : '#2a91ff';
            const videoLinkColor = '#ff0000';
            const buttonBgColor = isLightBg ? 'rgba(0, 120, 255, 0.2)' : 'rgba(77, 184, 255, 0.3)';
            const buttonHoverBgColor = isLightBg ? 'rgba(0, 120, 255, 0.4)' : 'rgba(77, 184, 255, 0.5)';

            // 基础文本颜色
            document.body.style.color = textColor;
            document.querySelectorAll('h1, h2, h3').forEach(el => el.style.color = textColor);
            
            // 导航链接
            document.querySelectorAll('.nav a').forEach(el => {
                el.style.color = linkColor;
                if (el.classList.contains('active')) el.style.color = activeLinkColor;
            });
            
            // 通用链接
            document.querySelectorAll('.link-list li a, .live-link').forEach(el => el.style.color = linkColor);
            
            // 日历样式
            document.querySelectorAll('.calendar th, .calendar td a:not(.has-video a)').forEach(el => el.style.color = textColor);
            document.querySelectorAll('.calendar td.disabled a').forEach(el => el.style.color = isLightBg ? '#999' : '#666');
            document.querySelectorAll('.calendar td.today a:not(.has-video a)').forEach(el => {
                el.style.backgroundColor = isLightBg ? 'rgba(0, 120, 255, 0.3)' : 'rgba(77, 184, 255, 0.3)';
            });
            
            // 日历按钮
            document.querySelectorAll('.calendar-header button').forEach(el => {
                el.style.backgroundColor = buttonBgColor;
                el.style.color = linkColor;
                el.addEventListener('mouseover', () => el.style.backgroundColor = buttonHoverBgColor);
                el.addEventListener('mouseout', () => el.style.backgroundColor = buttonBgColor);
            });
            
            // 提示文本
            document.querySelectorAll('.loading-tip').forEach(el => el.style.color = isLightBg ? '#666' : '#ddd');
            document.querySelectorAll('.error-tip').forEach(el => el.style.color = videoLinkColor);
            
            // 切片播放器
            document.querySelectorAll('#videoPlayerContainer').forEach(el => {
                el.style.background = isLightBg ? '#fff' : 'rgba(0,0,0,0.8)';
                el.style.boxShadow = isLightBg ? '0 2px 10px rgba(0,0,0,0.1)' : '0 2px 10px rgba(255,255,255,0.1)';
            });
            document.querySelectorAll('#playerTitle').forEach(el => el.style.color = isLightBg ? '#333' : '#f5f5f5');
        }

        // 加载外部HTML内容
        async function loadSectionContent(targetId, filePath) {
            const targetSection = document.getElementById(targetId);
            try {
                const response = await fetch(filePath);
                if (!response.ok) throw new Error(`加载失败：${response.status}`);
                const html = await response.text();
                targetSection.innerHTML = html;
                
                // 初始化对应模块
                if (targetId === 'live') await initLiveCalendar();
                if (targetId === 'clips') initClipsPage();
                
                // 重新适配颜色
                setTextColorByBackground();
                
                // 执行fanwork页面脚本
                if (targetId === 'fanwork') {
                    targetSection.querySelectorAll('script').forEach(oldScript => {
                        const newScript = document.createElement('script');
                        Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
                        newScript.textContent = oldScript.textContent;
                        oldScript.parentNode.replaceChild(newScript, oldScript);
                    });
                }
            } catch (error) {
                targetSection.innerHTML = `<div class="error-tip">加载失败：${error.message}</div>`;
                console.error(error);
            }
        }

        // 读取直播日期JSON
        async function getVideoDatesFromJson() {
            try {
                const response = await fetch('video-dates.json');
                if (!response.ok) throw new Error(`JSON加载失败：${response.status}`);
                const videoDates = await response.json();
                if (typeof videoDates !== 'object' || videoDates === null) {
                    throw new Error('JSON格式错误（需为对象）');
                }
                return videoDates;
            } catch (error) {
                console.error('读取video-dates.json失败:', error);
                // 兜底数据
                return {
                    "2025-12-24": { url: "https://example.com/live/20251224", title: "圣诞特别直播" },
                    "2026-01-06": { url: "https://example.com/live/20260106", title: "休闲聊天直播" },
                    "2026-01-08": { url: "https://example.com/live/20260108", title: "唱歌直播回放" },
                    "2026-01-10": { url: "https://example.com/live/202601010", title: "聊天互动直播" },
                    "2026-01-12": { url: "https://www.bilibili.com/video/BV1ktrhBfEuy/", title: "2026-01-12 出差阿勒泰直播" }
                };
            }
        }

        // 初始化直播日历
        async function initLiveCalendar() {
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const monthDisplay = document.getElementById('month-display');
            const calendarBody = document.getElementById('calendar-body');
            const recentVideosList = document.getElementById('recent-videos-list');
            
            if (!monthDisplay || !calendarBody || !recentVideosList) return;
            
            let currentDate = new Date();
            let currentYear = currentDate.getFullYear();
            let currentMonth = currentDate.getMonth();
            let videoDates = await getVideoDatesFromJson();

            // 渲染日历
            function renderCalendar(year, month) {
                monthDisplay.textContent = `${year}年${month + 1}月`;
                calendarBody.innerHTML = '';

                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const firstDayWeek = firstDay.getDay();
                const daysInMonth = lastDay.getDate();
                const today = new Date();
                const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;
                const todayDate = today.getDate();

                let dayCount = 1;
                let row = document.createElement('tr');

                // 上月占位
                for (let i = 0; i < firstDayWeek; i++) {
                    const td = document.createElement('td');
                    td.className = 'disabled';
                    const prevMonthLastDay = new Date(year, month, 0).getDate();
                    const prevMonthDay = prevMonthLastDay - firstDayWeek + i + 1;
                    td.innerHTML = `<a href="#">${prevMonthDay}</a>`;
                    row.appendChild(td);
                }

                // 当月日期
                for (let i = firstDayWeek; i < 7; i++) {
                    if (dayCount > daysInMonth) break;
                    const td = document.createElement('td');
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(dayCount).padStart(2, '0')}`;
                    
                    if (videoDates[dateStr]) {
                        td.className = 'has-video';
                        td.innerHTML = `<a href="${videoDates[dateStr].url}" target="_blank">${dayCount}</a>`;
                    } else {
                        td.innerHTML = `<a href="#">${dayCount}</a>`;
                    }

                    if (isCurrentMonth && dayCount === todayDate) td.classList.add('today');
                    row.appendChild(td);
                    dayCount++;
                }
                calendarBody.appendChild(row);

                // 剩余日期行
                while (dayCount <= daysInMonth) {
                    row = document.createElement('tr');
                    for (let i = 0; i < 7; i++) {
                        if (dayCount > daysInMonth) break;
                        const td = document.createElement('td');
                        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(dayCount).padStart(2, '0')}`;
                        
                        if (videoDates[dateStr]) {
                            td.className = 'has-video';
                            td.innerHTML = `<a href="${videoDates[dateStr].url}" target="_blank">${dayCount}</a>`;
                        } else {
                            td.innerHTML = `<a href="#">${dayCount}</a>`;
                        }

                        if (isCurrentMonth && dayCount === todayDate) td.classList.add('today');
                        row.appendChild(td);
                        dayCount++;
                    }
                    calendarBody.appendChild(row);
                }

                // 下月占位
                const remainingCells = 7 - row.children.length;
                if (remainingCells > 0 && row.children.length > 0) {
                    for (let i = 0; i < remainingCells; i++) {
                        const td = document.createElement('td');
                        td.className = 'disabled';
                        td.innerHTML = `<a href="#">${i + 1}</a>`;
                        row.appendChild(td);
                    }
                }
            }

            // 渲染近期视频列表
            function renderRecentVideosList() {
                recentVideosList.innerHTML = '';

                if (Object.keys(videoDates).length === 0) {
                    const li = document.createElement('li');
                    li.textContent = '暂无直播录像数据';
                    li.style.color = getComputedStyle(document.body).color;
                    recentVideosList.appendChild(li);
                    return;
                }

                const sortedVideos = Object.entries(videoDates)
                    .map(([date, data]) => ({ date, ...data }))
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
                const recentVideos = sortedVideos.slice(0, 5);

                recentVideos.forEach(video => {
                    const li = document.createElement('li');
                    const dateObj = new Date(video.date);
                    const formattedDate = `${dateObj.getFullYear()}年${dateObj.getMonth() + 1}月${dateObj.getDate()}日`;
                    li.innerHTML = `<a href="${video.url}" target="_blank">【${formattedDate}】${video.title}</a>`;
                    recentVideosList.appendChild(li);
                });
            }

            // 月份切换事件
            prevMonthBtn?.addEventListener('click', () => {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                renderCalendar(currentYear, currentMonth);
            });

            nextMonthBtn?.addEventListener('click', () => {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                renderCalendar(currentYear, currentMonth);
            });

            // 初始化渲染
            renderCalendar(currentYear, currentMonth);
            renderRecentVideosList();
        }

             // 导航切换
            function initNavSwitch() {
            const navLinks = document.querySelectorAll('.nav a');
            const contentSections = document.querySelectorAll('.content-section');
            const profileSection = document.querySelector('.profile-section');

            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    // 移除激活状态
                    navLinks.forEach(link => link.classList.remove('active'));
                    contentSections.forEach(section => section.classList.remove('active'));
                    
                    // 设置当前激活
                    this.classList.add('active');
                    const targetId = this.getAttribute('data-target');
                    const targetSection = document.getElementById(targetId);
                    targetSection.classList.add('active');

                    // 显示/隐藏个人信息
                    profileSection.classList.toggle('hidden', targetId !== 'home');

                    // 加载外部内容
                    const filePath = this.getAttribute('data-file');
                    if (filePath) loadSectionContent(targetId, filePath);

                    // 适配颜色
                    setTextColorByBackground();
                });
            });
        }

        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            setTextColorByBackground();
            initNavSwitch();
            window.addEventListener('resize', setTextColorByBackground);
        });
    </script>
</body>
</html>

